version: '2'
services:
    wordpress:
        image: dsifford/wordpress:nginx
        ports:
            - "22222:22222"
            - "443:443"
        volumes:
            # Database
            - ../data:/data
            # Plugins
            - ../wp-content/plugins/fanciest-author-box:/var/www/$site_name/htdocs/wp-content/plugins/fanciest-author-box
            - ../wp-content/plugins/fusion-core:/var/www/$site_name/htdocs/wp-content/plugins/fusion-core
            - ../wp-content/plugins/submission-flow:/var/www/$site_name/htdocs/wp-content/plugins/submission-flow
            - ../wp-content/plugins/tablepress-table-row-order:/var/www/$site_name/htdocs/wp-content/plugins/tablepress-table-row-order
            - ../wp-content/plugins/ultimate-social-deux:/var/www/$site_name/htdocs/wp-content/plugins/ultimate-social-deux
            - ../wp-content/plugins/wp-smush-pro:/var/www/$site_name/htdocs/wp-content/plugins/wp-smush-pro
            # Themes
            - ../dist/aliem:/var/www/$site_name/htdocs/wp-content/themes/aliem
            - ../wp-content/themes/Avada:/var/www/$site_name/htdocs/wp-content/themes/Avada
            # Uploads
            - ../wp-content/uploads:/var/www/$site_name/htdocs/wp-content/uploads
        env_file: ../.env
        environment:
            DB_NAME: wordpress
            DB_PASS: root
            DB_USER: root
            SITE_NAME: $site_name
            PHP_VERSION: 7.0
            PLUGINS: >-
                academic-bloggers-toolkit,
                co-authors-plus,
                disqus-notify-content-author,
                disqus-comment-system,
                easy-add-thumbnail,
                wysija-newsletters,
                mce-table-buttons,
                polldaddy,
                shortcodes-ultimate,
                slideshare,
                tablepress,
                wordpress-popular-posts,
                wordpress-seo,
            WP_DEBUG_DISPLAY: 'false'
            WP_DEBUG_LOG: 'true'
            WP_DEBUG: 'true'
    db:
        image: mariadb:10
        expose:
            - "3306"
        environment:
            MYSQL_ROOT_PASSWORD: root
        volumes:
            - data:/var/lib/mysql

    # Production Builds
    wordpress_prod:
        extends: wordpress
        restart: on-failure:10
        ports:
            - "80:80"
        environment:
            DB_PASS: $DB_PASS
    db_prod:
        extends: db
        restart: on-failure:10
        environment:
            MYSQL_ROOT_PASSWORD: $DB_PASS
